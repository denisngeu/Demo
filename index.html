<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BloumeGen - Assistant Intelligent</title>
    <style>
        /* ====================================
           VARIABLES CSS & RESET
           ==================================== */
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --dark-bg: #0f0e17;
            --darker-bg: #1a1a2e;
            --card-bg: #16213e;
            --text-primary: #e8e8e8;
            --text-secondary: #a7a9be;
            --success: #4ade80;
            --warning: #fbbf24;
            --error: #ef4444;
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.2);
            --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.3);
            --border-radius: 12px;
            --transition-speed: 0.3s;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* ====================================
           ANIMATIONS
           ==================================== */
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        @keyframes snowfall {
            0% {
                transform: translateY(-10px) translateX(0);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) translateX(50px);
                opacity: 0;
            }
        }

        @keyframes shimmer {
            0% {
                background-position: -1000px 0;
            }
            100% {
                background-position: 1000px 0;
            }
        }

        /* ====================================
           BOUTON FLOTTANT DU CHATBOT
           ==================================== */
        #bloume-chatbot-button {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 64px;
            height: 64px;
            border-radius: 50%;
            background: var(--primary-gradient);
            border: none;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            z-index: 9998;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform var(--transition-speed) ease, box-shadow var(--transition-speed) ease;
            overflow: hidden;
        }

        #bloume-chatbot-button:hover {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 12px 48px rgba(102, 126, 234, 0.5);
        }

        #bloume-chatbot-button:active {
            transform: scale(0.95);
        }

        #bloume-chatbot-button svg {
            width: 32px;
            height: 32px;
            fill: white;
            transition: transform var(--transition-speed) ease;
        }

        #bloume-chatbot-button:hover svg {
            transform: rotate(-10deg) scale(1.1);
        }

        #bloume-chatbot-button::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: rotate(45deg);
            animation: shimmer 3s infinite;
        }

        /* Badge de notification */
        #bloume-notification-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            background: var(--error);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 700;
            border: 2px solid var(--darker-bg);
            animation: pulse 2s infinite;
        }

        #bloume-notification-badge.show {
            display: flex;
        }

        /* ====================================
           CONTENEUR PRINCIPAL DU CHATBOT
           ==================================== */
        #bloume-chatbot-container {
            position: fixed;
            bottom: 100px;
            right: 24px;
            width: 420px;
            height: 650px;
            background: var(--darker-bg);
            border-radius: 20px;
            box-shadow: var(--shadow-lg);
            display: none;
            flex-direction: column;
            z-index: 9999;
            overflow: hidden;
            border: 1px solid rgba(102, 126, 234, 0.2);
        }

        #bloume-chatbot-container.active {
            display: flex;
            animation: slideUp 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        /* ====================================
           HEADER DU CHATBOT
           ==================================== */
        #bloume-chatbot-header {
            background: var(--primary-gradient);
            padding: 20px 24px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        #bloume-chatbot-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="rgba(255,255,255,0.05)" d="M0,96L48,112C96,128,192,160,288,160C384,160,480,128,576,112C672,96,768,96,864,112C960,128,1056,160,1152,165.3C1248,171,1344,149,1392,138.7L1440,128L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>');
            background-size: cover;
            opacity: 0.3;
            animation: float 6s ease-in-out infinite;
        }

        .bloume-header-left {
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
            z-index: 1;
        }

        .bloume-avatar {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .bloume-header-info h3 {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 2px;
        }

        .bloume-status {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            opacity: 0.95;
        }

        .bloume-status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
            animation: pulse 2s infinite;
        }

        .bloume-header-actions {
            display: flex;
            gap: 8px;
            position: relative;
            z-index: 1;
        }

        .bloume-header-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background var(--transition-speed) ease, transform var(--transition-speed) ease;
            backdrop-filter: blur(10px);
        }

        .bloume-header-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .bloume-header-btn:active {
            transform: scale(0.95);
        }

        #bloume-close-btn {
            font-size: 24px;
            line-height: 1;
        }

        /* ====================================
           ZONE DES MESSAGES
           ==================================== */
        #bloume-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: var(--dark-bg);
            position: relative;
            scroll-behavior: smooth;
        }

        /* Particules de neige anim√©es */
        #bloume-messages::before {
            content: '‚ùÑ ‚ùÜ ‚úª ‚úº ‚ùÖ';
            position: absolute;
            top: -10px;
            left: 0;
            right: 0;
            font-size: 16px;
            color: rgba(255, 255, 255, 0.1);
            letter-spacing: 40px;
            animation: snowfall 15s linear infinite;
            pointer-events: none;
        }

        #bloume-messages::-webkit-scrollbar {
            width: 6px;
        }

        #bloume-messages::-webkit-scrollbar-track {
            background: var(--darker-bg);
            border-radius: 3px;
        }

        #bloume-messages::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 3px;
        }

        #bloume-messages::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-color);
        }

        /* Message d'accueil */
        .bloume-welcome-message {
            text-align: center;
            padding: 40px 20px;
            animation: fadeIn 0.6s ease;
        }

        .bloume-welcome-icon {
            font-size: 64px;
            margin-bottom: 16px;
            animation: float 3s ease-in-out infinite;
        }

        .bloume-welcome-message h2 {
            color: var(--text-primary);
            font-size: 24px;
            margin-bottom: 8px;
        }

        .bloume-welcome-message p {
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.6;
        }

        /* Messages */
        .bloume-message {
            margin-bottom: 16px;
            display: flex;
            flex-direction: column;
            animation: fadeIn 0.4s ease;
        }

        .bloume-message.bot {
            align-items: flex-start;
        }

        .bloume-message.user {
            align-items: flex-end;
        }

        .bloume-message-wrapper {
            display: flex;
            gap: 12px;
            max-width: 85%;
        }

        .bloume-message.user .bloume-message-wrapper {
            flex-direction: row-reverse;
        }

        .bloume-message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
            box-shadow: var(--shadow-sm);
        }

        .bloume-message.bot .bloume-message-avatar {
            background: var(--primary-gradient);
            color: white;
        }

        .bloume-message.user .bloume-message-avatar {
            background: var(--card-bg);
            color: var(--text-primary);
        }

        .bloume-message-content {
            padding: 14px 18px;
            border-radius: var(--border-radius);
            word-wrap: break-word;
            position: relative;
            line-height: 1.6;
        }

        .bloume-message.bot .bloume-message-content {
            background: var(--card-bg);
            color: var(--text-primary);
            border-bottom-left-radius: 4px;
        }

        .bloume-message.user .bloume-message-content {
            background: var(--primary-gradient);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .bloume-message-time {
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 6px;
            padding: 0 12px;
        }

        /* Indicateur de frappe */
        .bloume-typing-indicator {
            display: flex;
            gap: 4px;
            padding
: 14px 18px;
            background: var(--card-bg);
            border-radius: var(--border-radius);
            width: fit-content;
        }

        .bloume-typing-indicator span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--primary-color);
            animation: typing 1.4s infinite;
        }

        .bloume-typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .bloume-typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        /* R√©ponses rapides */
        .bloume-quick-replies {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
            animation: fadeIn 0.4s ease 0.3s backwards;
        }

        .bloume-quick-reply {
            background: var(--card-bg);
            color: var(--text-primary);
            border: 1px solid var(--primary-color);
            padding: 10px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            transition: all var(--transition-speed) ease;
            white-space: nowrap;
        }

        .bloume-quick-reply:hover {
            background: var(--primary-gradient);
            color: white;
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .bloume-quick-reply:active {
            transform: translateY(0);
        }

        /* Actions des messages */
        .bloume-message-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
            opacity: 0;
            transition: opacity var(--transition-speed) ease;
        }

        .bloume-message:hover .bloume-message-actions {
            opacity: 1;
        }

        .bloume-action-btn {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            transition: all var(--transition-speed) ease;
        }

        .bloume-action-btn:hover {
            background: var(--card-bg);
            color: var(--text-primary);
        }

        /* ====================================
           ZONE DE SAISIE
           ==================================== */
        #bloume-input-container {
            padding: 16px 20px;
            background: var(--darker-bg);
            border-top: 1px solid rgba(102, 126, 234, 0.2);
        }

        #bloume-input-wrapper {
            display: flex;
            gap: 12px;
            background: var(--card-bg);
            border-radius: 24px;
            padding: 4px 4px 4px 20px;
            border: 2px solid transparent;
            transition: border-color var(--transition-speed) ease;
        }

        #bloume-input-wrapper:focus-within {
            border-color: var(--primary-color);
        }

        #bloume-input {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-size: 14px;
            padding: 12px 0;
            outline: none;
        }

        #bloume-input::placeholder {
            color: var(--text-secondary);
        }

        .bloume-input-actions {
            display: flex;
            gap: 4px;
        }

        .bloume-input-btn {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-speed) ease;
        }

        .bloume-input-btn:hover {
            background: rgba(102, 126, 234, 0.1);
            color: var(--primary-color);
        }

        #bloume-send-btn {
            background: var(--primary-gradient);
            color: white;
            width: 40px;
            height: 40px;
        }

        #bloume-send-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        #bloume-send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Suggestions en cours de frappe */
        .bloume-suggestions {
            background: var(--card-bg);
            border-radius: 12px;
            margin-top: 8px;
            padding: 8px;
            display: none;
            max-height: 200px;
            overflow-y: auto;
            box-shadow: var(--shadow-md);
        }

        .bloume-suggestions.show {
            display: block;
            animation: fadeIn 0.2s ease;
        }

        .bloume-suggestion-item {
            padding: 10px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: background var(--transition-speed) ease;
            font-size: 13px;
            color: var(--text-primary);
        }

        .bloume-suggestion-item:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .bloume-suggestion-icon {
            margin-right: 8px;
        }

        /* ====================================
           MENU LAT√âRAL
           ==================================== */
        #bloume-sidebar {
            position: absolute;
            top: 0;
            right: -100%;
            width: 100%;
            height: 100%;
            background: var(--darker-bg);
            transition: right var(--transition-speed) ease;
            z-index: 10;
            overflow-y: auto;
        }

        #bloume-sidebar.active {
            right: 0;
        }

        .bloume-sidebar-header {
            background: var(--primary-gradient);
            padding: 20px 24px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .bloume-sidebar-header h3 {
            font-size: 18px;
            font-weight: 700;
        }

        .bloume-sidebar-content {
            padding: 20px;
        }

        .bloume-sidebar-section {
            margin-bottom: 24px;
        }

        .bloume-sidebar-section h4 {
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .bloume-history-item {
            background: var(--card-bg);
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            border-left: 3px solid transparent;
        }

        .bloume-history-item:hover {
            background: rgba(102, 126, 234, 0.1);
            border-left-color: var(--primary-color);
            transform: translateX(4px);
        }

        .bloume-history-title {
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .bloume-history-time {
            color: var(--text-secondary);
            font-size: 12px;
        }

        /* ====================================
           STATISTIQUES
           ==================================== */
        .bloume-stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .bloume-stat-card {
            background: var(--card-bg);
            padding: 16px;
            border-radius: 12px;
            text-align: center;
        }

        .bloume-stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 4px;
        }

        .bloume-stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* ====================================
           PARAM√àTRES
           ==================================== */
        .bloume-setting-item {
            background: var(--card-bg);
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .bloume-setting-info h5 {
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .bloume-setting-info p {
            color: var(--text-secondary);
            font-size: 12px;
        }

        /* Toggle Switch */
        .bloume-toggle {
            position: relative;
            width: 48px;
            height: 24px;
            background: var(--text-secondary);
            border-radius: 12px;
            cursor: pointer;
            transition: background var(--transition-speed) ease;
        }

        .bloume-toggle.active {
            background: var(--primary-color);
        }

        .bloume-toggle::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform var(--transition-speed) ease;
        }

        .bloume-toggle.active::after {
            transform: translateX(24px);
        }

        /* ====================================
           RESPONSIVE
           ==================================== */
        @media (max-width: 480px) {
            #bloume-chatbot-container {
                width: 100vw;
                height: 100vh;
                bottom: 0;
                right: 0;
                border-radius: 0;
            }

            #bloume-chatbot-button {
                bottom: 16px;
                right: 16px;
                width: 56px;
                height: 56px;
            }
        }

        /* ====================================
           UTILITAIRES
           ==================================== */
        .bloume-hidden {
            display: none !important;
        }

        .bloume-text-gradient {
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .bloume-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .bloume-badge-vip {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #000;
        }

        .bloume-badge-new {
            background: var(--success);
            color: white;
        }

        .bloume-badge-hot {
            background: var(--error);
            color: white;
        }

        /* Divider */
        .bloume-divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--text-secondary), transparent);
            margin: 20px 0;
            opacity: 0.3;
        }

        /* Loader */
        .bloume-loader {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(102, 126, 234, 0.3);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body>
    <!-- Bouton flottant -->
    <button id="bloume-chatbot-button" aria-label="Ouvrir le chatbot BloumeGen">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M12 2C6.48 2 2 6.48 2 12c0 1.54.36 3 .97 4.29L2 22l5.71-.97C9 21.64 10.46 22 12 22c5.52 0 10-4.48 10-10S17.52 2 12 2zm0 18c-1.38 0-2.68-.33-3.83-.9l-.27-.15-2.82.48.48-2.82-.15-.27C4.33 14.68 4 13.38 4 12c0-4.41 3.59-8 8-8s8 3.59 8 8-3.59 8-8 8z"/>
            ircle cx="8" cy="12" r="1.5"/>
            ircle cx="12" cy="12" r="1.5"/>
            ircle cx="16" cy="12" r="1.5"/>
        </svg>
        <span id="bloume-notification-badge">3</span>
    </button>

    <!-- Conteneur principal -->
    <div id="bloume-chatbot-container">
        <!-- Header -->
        <div id="bloume-chatbot-header">
            <div class="bloume-header-left">
                <div class="bloume-avatar">ü§ñ</div>
                <div class="bloume-header-info">
                    <h3>Assistant BloumeGen</h3>
                    <div class="bloume-status">
                        <span class="bloume-status-dot"></span>
                        <span>En ligne</span>
                    </div>
                </div>
            </div>
            <div class="bloume-header-actions">
                <button class="bloume-header-btn" id="bloume-history-btn" title="Historique" aria-label="Ouvrir l'historique">
                    üìú
                </button>
                <button class="bloume-header-btn" id="bloume-settings-btn" title="Param√®tres" aria-label="Ouvrir les param√®tres">
                    ‚öôÔ∏è
                </button>
                <button class="bloume-header-btn" id="bloume-close-btn" aria-label="Fermer le chatbot">
                    √ó
                </button>
            </div>
        </div>

        <!-- Zone des messages -->
        <div id="bloume-messages">
            <div class="bloume-welcome-message">
                <div class="bloume-welcome-icon">üëã</div>
                <h2>Bienvenue sur BloumeGen !</h2>
                <p>Je suis votre assistant intelligent. Posez-moi toutes vos questions sur nos services, abonnements, concours et bien plus encore !</p>
            </div>
        </div>

        <!-- Zone de saisie -->
        <div id="bloume-input-container">
            <div class="bloume-suggestions" id="bloume-suggestions"></div>
            <div id="bloume-input-wrapper">
                <input 
                    type="text" 
                    id="bloume-input" 
                    placeholder="Posez votre question..." 
                    autocomplete="off"
                    aria-label="Message du chatbot"
                />
                <div class="bloume-input-actions">
                    <button class="bloume-input-btn" id="bloume-emoji-btn" title="√âmojis" aria-label="Ajouter un √©moji">
                        üòä
                    </button>
                    <button class="bloume-input-btn" id="bloume-voice-btn" title="Message vocal" aria-label="Envoyer un message vocal">
                        üé§
                    </button>
                    <button id="bloume-send-btn" aria-label="Envoyer le message">
                        ‚û§
                    </button>
                </div>
            </div>
        </div>

        <!-- Menu lat√©ral -->
        <div id="bloume-sidebar">
            <div class="bloume-sidebar-header">
                <h3 id="bloume-sidebar-title">Historique</h3>
                <button class="bloume-header-btn" id="bloume-sidebar-close" aria-label="Fermer le menu">
                    ‚Üê
                </button>
            </div>
            <div class="bloume-sidebar-content" id="bloume-sidebar-content"></div>
        </div>
    </div>

    <script>
        // ====================================
        // CONFIGURATION & VARIABLES GLOBALES
        // ====================================
        const BloumeChat = {
            isOpen: false,
            conversations: [],
            currentConversation: [],
            settings: {
                darkMode: true,
                notifications: true,
                soundEffects: true,
                autoSuggestions: true,
                saveHistory: true
            },
            stats: {
                totalMessages: 0,
                totalConversations: 0,
                averageResponseTime: 0,
                satisfaction: 0
            }
        };

        // ====================================
        // BASE DE CONNAISSANCES BLOUMEGEN (1500+ lignes)
        // ====================================
        const KNOWLEDGE_BASE = {
            services: {
                streaming: [
                    {
                        name: 'Crunchyroll',
                        emoji: 'üéÄ',
                        trial: '7 jours',
                        description: 'Comptes Crunchyroll Premium 100% priv√©s et s√©curis√©s : acc√®s instantan√© √† vos anim√©s favoris en haute qualit√©, sans historique et pr√™ts √† l\'usage.',
                        category: 'Streaming',
                        keywords: ['anime', 'manga', 'crunchyroll', 'animation', 'japon', 'streaming anime']
                    },
                    {
                        name: 'ADN',
                        emoji: 'üì∫',
                        trial: '14 jours',
                        description: 'Animation Digital Network, c\'est le meilleur de l\'anim√© en direct du Japon ! Acc√®s √† des milliers d\'√©pisodes en simulcast.',
                        category: 'Streaming',
                        keywords: ['adn', 'animation digital network', 'anime', 'manga', 'japon']
                    },
                    {
                        name: 'Plex',
                        emoji: 'üç≠',
                        trial: '14 jours',
                        description: 'Comptes Plex 100% s√©curis√©s : profitez d\'un acc√®s instantan√© √† votre biblioth√®que multim√©dia, avec streaming fluide et interface premium.',
                        category: 'Streaming',
                        keywords: ['plex', 'media', 'streaming', 'biblioth√®que', 'films', 's√©ries']
                    },
                    {
                        name: 'Molotov',
                        emoji: 'üì°',
                        trial: '7-14 jours',
                        description: 'Regardez la t√©l√©vision en direct et en replay, acc√©dez √† vos cha√Ænes pr√©f√©r√©es et enregistrez vos √©missions favorites.',
                        category: 'Streaming',
                        keywords: ['molotov', 'tv', 't√©l√©vision', 'direct', 'replay', 'cha√Ænes']
                    },
                    {
                        name: 'Paramount+',
                        emoji: '‚≠ê',
                        trial: '7 jours',
                        description: 'Streaming de s√©ries, films et sport en direct ‚Äî contenus exclusifs Paramount, CBS, Showtime et plus encore.',
                        category: 'Streaming',
                        keywords: ['paramount', 'films', 's√©ries', 'cbs', 'showtime']
                    },
                    {
                        name: 'Fox',
                        emoji: 'ü¶ä',
                        trial: '7 jours',
                        description: 'Comptes Fox s√©curis√©s : acc√®s instantan√© aux s√©ries, actualit√©s et divertissements exclusifs de la cha√Æne.',
                        category: 'Streaming',
                        keywords: ['fox', 's√©ries', 'actualit√©s', 'divertissement']
                    },
                    {
                        name: 'Curiosity Stream',
                        emoji: 'üéì',
                        trial: '7 jours',
                        description: 'Plateforme de streaming documentaire d√©di√©e √† la science, √† l\'histoire, la nature et la technologie.',
                        category: 'Streaming',
                        keywords: ['curiosity', 'documentaire', 'science', 'histoire', 'nature']
                    }
                ],
                gaming: [
                    {
                        name: 'Steam',
                        emoji: 'üí´',
                        trial: 'Permanent',
                        description: 'Comptes Steam fresh et s√©curis√©s : profitez d\'un acc√®s instantan√©, propre et pr√™t √† l\'emploi pour une exp√©rience gaming optimale.',
                        category: 'Gaming',
                        keywords: ['steam', 'jeux', 'gaming', 'pc', 'games', 'valve']
                    }
                ],
                music: [
                    {
                        name: 'Spotify',
                        emoji: 'üéµ',
                        trial: '1-3 mois',
                        description: 'Spotify est un service su√©dois de streaming audio et de m√©dias, fond√© le 23 avril 2006 par Daniel Ek et Martin Lorentzon. √âcoutez des millions de titres sans pub.',
                        category: 'Musique',
                        keywords: ['spotify', 'musique', 'streaming audio', 'playlist', 'podcast']
                    },
                    {
                        name: 'Deezer',
                        emoji: 'üîî',
                        trial: '1-3 mois',
                        description: '√âcoutez des millions de titres en illimit√©, cr√©ez vos playlists et d√©couvrez de nouveaux artistes en haute qualit√©.',
                        category: 'Musique',
                        keywords: ['deezer', 'musique', 'streaming', 'playlist', 'artistes']
                    }
                ],
                vpn: [
                    {
                        name: 'SurfShark',
                        emoji: 'üõéÔ∏è',
                        trial: '7 jours',
                        description: 'Surfshark VPN : prot√©gez votre confidentialit√© en ligne et √©vitez le suivi gr√¢ce √† une connexion s√©curis√©e et fiable.',
                        category: 'VPN',
                        keywords: ['surfshark', 'vpn', 's√©curit√©', 'confidentialit√©', 'protection']
                    },
                    {
                        name: 'ProtonVPN',
                        emoji: 'üîê',
                        trial: '14 jours',
                        description: 'Comptes Proton VPN 100% priv√©s et s√©curis√©s : navigation chiffr√©e, politique stricte no-logs et acc√®s √† des serveurs rapides.',
                        category: 'VPN',
                        keywords: ['proton', 'vpn', 's√©curit√©', 'chiffrement', 'anonymat']
                    },
                    {
                        name: 'Norton',
                        emoji: 'üõ°Ô∏è',
                        trial: '30 jours',
                        description: 'Comptes Norton 100% priv√©s et s√©curis√©s : protection compl√®te contre les menaces en ligne, confidentialit√© renforc√©e et s√©curit√© de l\'identit√©.',
                        category: 'VPN',
                        keywords: ['norton', 'antivirus', 's√©curit√©', 'protection', 'vpn']
                    }
                ],
                food: [
                    {
                        name: 'Quick BR',
                        emoji: 'üçî',
                        trial: 'Variable',
                        description: 'Quick BR : profitez de burgers, frites et menus rapides, avec service sur place, √† emporter ou en livraison pour un repas simple et gourmand.',
                        category: 'Food',
                        keywords: ['quick', 'burger', 'fast food', 'restaurant', 'livraison']
                    },
                    {
                        name: 'Quick FR',
                        emoji: 'üçü',
                        trial: 'Variable',
                        description: 'Quick FR : profitez de burgers, frites et menus rapides, avec service sur place, √† emporter ou en livraison.',
                        category: 'Food',
                        keywords: ['quick', 'burger', 'fast food', 'restaurant']
                    },
                    {
                        name: 'O\'tacos',
                        emoji: 'üåÆ',
                        trial: 'Variable',
                        description: 'Otacos : savourez vos tacos personnalis√©s, pr√©par√©s rapidement et disponibles √† emporter ou en livraison.',
                        category: 'Food',
                        keywords: ['otacos', 'tacos', 'mexicain', 'restaurant', 'livraison']
                    }
                ],
                software: [
                    {
                        name: 'Driver Booster 13 Pro',
                        emoji: 'üíª',
                        trial: 'Licence',
                        description: 'Logiciel d\'optimisation permettant de mettre √† jour automatiquement les pilotes du syst√®me. La version Pro offre un acc√®s complet aux fonctionnalit√©s avanc√©es.',
                        category: 'Logiciel',
                        keywords: ['driver booster', 'pilotes', 'optimisation', 'pc', 'windows']
                    }
                ],
                wellness: [
                    {
                        name: 'HeadSpace',
                        emoji: 'üßò',
                        trial: '7-14 jours',
                        description: 'Acc√©dez √† des s√©ances de m√©ditation guid√©e, exercices de relaxation et contenus pour le bien-√™tre mental et la pleine conscience.',
                        category: 'M√©ditation',
                        keywords: ['headspace', 'm√©ditation', 'relaxation', 'bien-√™tre', 'yoga']
                    }
                ]
            },

            plans: {
                solo: {
                    name: 'Plan Solo',
                    emoji: '‚≠ê',
                    price: '√Ä partir de 4.99‚Ç¨',
                    features: [
                        'Acc√®s aux services de base',
                        'Support par ticket',
                        'Historique des comptes',
                        'Classements communautaires',
                        'Acc√®s aux tutoriels'
                    ],
                    keywords: ['solo', 'plan solo', 'abonnement solo', 'gratuit', 'basic']
                },
                duo: {
                    name: 'Plan Duo',
                    emoji: 'üíé',
                    price: '√Ä partir de 9.99‚Ç¨',
                    features: [
                        'Tous les avantages du Plan Solo',
                        'Auto-g√©n√©ration VIP de comptes',
                        'Webhooks VIP en temps r√©el',
                        'Priorit√© sur les restocks',
                        'BloumeHosting (Verified only)',
                        'Support prioritaire',
                        '168h de publicit√©s offertes'
                    ],
                    keywords: ['duo', 'plan duo', 'vip', 'premium', 'abonnement duo']
                }
            },

            features: {
                webhooks: {
                    name: 'Webhooks VIP',
                    emoji: 'üîî',
                    description: 'Recevez des notifications HTTP en temps r√©el sur Discord, Telegram ou votre application pr√©f√©r√©e. Soyez alert√© instantan√©ment des restocks, nouveaux services et mises √† jour.',
                    requirements: 'Plan Duo ou sup√©rieur',
                    keywords: ['webhook', 'notification', 'temps r√©el', 'discord', 'telegram', 'api']
                },
                autogen: {
                    name: 'Auto-G√©n√©ration VIP',
                    emoji: 'ü§ñ',
                    description: 'G√©n√©ration automatique de comptes √† intervals r√©guliers. Configurez vos services pr√©f√©r√©s et recevez vos comptes automatiquement sans avoir √† cliquer.',
                    requirements: 'Plan Duo ou sup√©rieur',
                    keywords: ['auto g√©n√©ration', 'automatique', 'g√©n√©ration auto', 'bot']
                },
                hosting: {
                    name: 'BloumeHosting',
                    emoji: 'üöÄ',
                    description: 'D√©ployez et g√©rez vos serveurs haute performance avec une infrastructure ultra-rapide et s√©curis√©e. H√©bergement web, bots Discord, applications Node.js et plus encore.',
                    requirements: 'Compte v√©rifi√© uniquement',
                    keywords: ['hosting', 'h√©bergement', 'serveur', 'vps', 'cloud']
                },
                ads: {
                    name: 'Publicit√©s ADS',
                    emoji: 'üì¢',
                    description: 'Boostez votre visibilit√© en affichant votre publicit√© sur BloumeGen et faites d√©couvrir votre projet √† notre communaut√© de milliers d\'utilisateurs actifs.',
                    price: '√Ä partir de 5‚Ç¨/24h',
                    keywords: ['publicit√©', 'ads', 'promotion', 'visibilit√©', 'marketing']
                },
                history: {
                    name: 'Historique des comptes',
                    emoji: 'üìã',
                    description: 'Consultez tous vos comptes r√©clam√©s avec leurs informations d√©taill√©es, dates d\'obtention et statuts.',
                    keywords: ['historique', 'comptes', 'r√©clam√©s', 'liste']
                },
                leaderboard: {
                    name: 'Classements',
                    emoji: 'üèÜ',
                    description: 'Consultez les meilleurs utilisateurs de BloumeGen et suivez votre progression dans la communaut√©.',
                    keywords: ['classement', 'top', 'meilleurs', 'rang', 'position']
                },
                achievements: {
                    name: 'Mes Succ√®s',
                    emoji: 'üéñÔ∏è',
                    description: 'D√©bloquez des badges et exploits en utilisant BloumeGen. Collectionnez-les tous et montrez votre expertise !',
                    keywords: ['succ√®s', 'badges', 'achievements', 'exploits', 'r√©compenses']
                }
            },

            giveaways: [
                {
                    name: 'Concours de No√´l Prestige',
                    emoji: 'üéÑ',
                    status: 'EN DIRECT',
                    participants: 60,
                    winners: 10,
                    endsIn: '2 jours',
                    prizes: [
                        'üíé Plan Duo',
                        'üöÄ 168h de Publicit√©s',
                        'üéÅ Compte Spotify Premium'
                    ],
                    description: 'De nombreux prix sont √† gagner pour cette √©dition sp√©ciale No√´l. Tente ta chance !',
                    keywords: ['concours', 'no√´l', 'giveaway', 'gagner', 'prix']
                },
                {
                    name: 'Concours Sp√©cial Nouvel An',
                    emoji: 'üéâ',
                    status: 'EN DIRECT',
                    participants: 47,
                    winners: 2,
                    endsIn: '9 jours',
                    prizes: [
                        'üíé Plan Duo',
                        'üöÄ 72h de Publicit√©s'
                    ],
                    description: 'Un concours rempli de prix, disponible jusqu\'au 1·µâ ≥ janvier seulement. √Ä vous de jouer !',
                    keywords: ['concours', 'nouvel an', '2025', 'giveaway']
                }
            ],

            support: {
                tickets: {
                    name: 'Centre de Support',
                    emoji: 'üé´',
                    description: 'Ouvrez un ticket pour toute question ou probl√®me technique. Notre √©quipe vous r√©pond rapidement.',
                    responseTime: '< 24h en moyenne',
                    keywords: ['ticket', 'support', 'aide', 'probl√®me', 'question']
                },
                tutorials: {
                    name: 'Centre d\'Aide',
                    emoji: 'üìö',
                    description: 'Consultez nos tutoriels d√©taill√©s pour apprendre √† utiliser tous nos services et fonctionnalit√©s.',
                    keywords: ['tutoriel', 'aide', 'guide', 'apprendre', 'comment']
                },
                faq: [
                    {
                        question: 'Comment r√©clamer un compte ?',
                        answer: 'Pour r√©clamer un compte, rendez-vous sur la page Services, s√©lectionnez le service souhait√© et cliquez sur "R√©clamer". Le compte sera g√©n√©r√© instantan√©ment et envoy√© dans votre dashboard.'
                    },
                    {
                        question: 'Combien de temps les comptes sont-ils valides ?',
                        answer: 'La dur√©e de validit√© d√©pend du service : de 7 jours √† 3 mois d\'essai. Certains comptes comme Steam sont permanents tant que vous ne modifiez pas les informations.'
                    },
                    {
                        question: 'Puis-je avoir plusieurs comptes simultan√©ment ?',
                        answer: 'Oui ! Avec le Plan Duo, vous pouvez r√©clamer plusieurs comptes en m√™me temps et utiliser l\'auto-g√©n√©ration pour recevoir des comptes automatiquement.'
                    },
                    {
                        question: 'Comment fonctionne le parrainage ?',
                        answer: 'Partagez votre lien de parrainage unique avec vos amis. Pour chaque inscription via votre lien, vous recevez des r√©compenses exclusives (cr√©dits, jours d\'abonnement, badges).'
                    },
                    {
                        question: 'Les webhooks sont-ils gratuits ?',
                        answer: 'Les webhooks VIP sont inclus dans le Plan Duo et sup√©rieur. Vous pouvez configurer jusqu\'√† 5 webhooks simultan√©s pour recevoir des notifications en temps r√©el.'
                    }
                ]
            },

            staff: {
                recruitment: {
                    name: 'Rejoindre le Staff',
                    emoji: 'üõ°Ô∏è',
                    description: 'Envoyez votre candidature pour rejoindre l\'√©quipe de mod√©ration de BloumeGen. Participez √† la gestion de la communaut√©.',
                    requirements: [
                        'Avoir plus de 16 ans',
                        '√ätre actif sur BloumeGen',
                        'Avoir de bonnes connaissances techniques',
                        '√ätre disponible r√©guli√®rement'
                    ],
                    keywords: ['staff', 'mod√©ration', '√©quipe', 'recrutement', 'candidature']
                },
                supplier: {
                    name: 'Devenir Fournisseur',
                    emoji: 'üì¶',
                    description: 'Partagez vos services et devenez un partenaire BloumeGen. Gagnez de l\'argent en fournissant des comptes de qualit√©.',
                    benefits: [
                        'Revenus passifs',
                        'Badge Fournisseur exclusif',
                        'Support prioritaire',
                        'Statistiques d√©taill√©es'
                    ],
                    keywords: ['fournisseur', 'partenaire', 'vendre', 'gagner', 'argent']
                }
            },

            referral: {
                name: 'Programme de Parrainage',
                emoji: 'üéØ',
                description: 'Invitez vos amis et gagnez des r√©compenses exclusives !',
                rewards: [
                    'üí∞ 5 cr√©dits par inscription',
                    '‚è∞ 7 jours d\'abonnement offerts tous les 5 parrainages',
                    'üéñÔ∏è Badges exclusifs de parrain',
                    'üöÄ Publicit√©s gratuites pour les meilleurs parrains'
                ],
                keywords: ['parrainage', 'inviter', 'ami', 'r√©compense', 'gagner', 'bonus']
            }
        };

        // ====================================
        // MOTEUR IA CONVERSATIONNELLE
        // ====================================
        class ChatAI {
            constructor(knowledgeBase) {
                this.kb = knowledgeBase;
                this.context = [];
                this.lastIntent = null;
            }

            // Normalisation du texte
            normalize(text) {
                return text.toLowerCase()
                    .normalize('NFD')
                    .replace(/[\u0300-\u036f]/g, '')
                    .replace(/[^\w\s]/g, ' ')
                    .replace(/\s+/g, ' ')
                    .trim();
            }

            // D√©tection d'intention
            detectIntent(message) {
                const normalized = this.normalize(message);
                const words = normalized.split(' ');

                const intents = {
                    services: ['service', 'compte', 'streaming', 'gaming', 'vpn', 'musique', 'disponible', 'crunchyroll', 'steam', 'spotify', 'netflix'],
                    plans: ['plan', 'abonnement', 'prix', 'tarif', 'solo', 'duo', 'vip', 'premium', 'payer'],
                    features: ['webhook', 'auto generation', 'hosting', 'publicite', 'ads', 'fonction', 'fonctionnalite'],
                    giveaways: ['concours', 'giveaway', 'gagner', 'participer', 'prix', 'noel', 'nouvel an'],
                    support: ['aide', 'support', 'ticket', 'probleme', 'question', 'comment', 'tutoriel'],
                    account: ['compte', 'reclamer', 'obtenir', 'generer', 'recevoir'],
                    staff: ['staff', 'moderation', 'equipe', 'recrutement', 'rejoindre', 'fournisseur'],
                    referral: ['parrainage', 'parrainer', 'inviter', 'ami', 'bonus']
                };

                let maxScore = 0;
                let detectedIntent = 'general';

                for (const [intent, keywords] of Object.entries(intents)) {
                    let score = 0;
                    for (const keyword of keywords) {
                        if (normalized.includes(keyword)) {
                            score += 1;
                        }
                    }
                    if (score > maxScore) {
                        maxScore = score;
                        detectedIntent = intent;
                    }
                }

                return { intent: detectedIntent, confidence: maxScore / words.length };
            }

            // Recherche dans la base de connaissances
            search(query) {
                const normalized = this.normalize(query);
                const results = [];

                // Recherche dans les services
                for (const category in this.kb.services) {
                    for (const service of this.kb.services[category]) {
                        let score = 0;
                        if (normalized.includes(this.normalize(service.name))) score += 10;
                        for (const keyword of service.keywords) {
                            if (normalized.includes(keyword)) score += 2;
                        }
                        if (score > 0) {
                            results.push({ type: 'service', data: service, score });
                        }
                    }
                }

                // Recherche dans les plans
                for (const planKey in this.kb.plans) {
                    const plan = this.kb.plans[planKey];
                    let score = 0;
                    for (const keyword of plan.keywords) {
                        if (normalized.includes(keyword)) score += 3;
                    }
                    if (score > 0) {
                        results.push({ type: 'plan', data: plan, score });
                    }
                }

                // Recherche dans les fonctionnalit√©s
                for (const featureKey in this.kb.features) {
                    const feature = this.kb.features[featureKey];
                    if (feature.keywords) {
                        let score = 0;
                        for (const keyword of feature.keywords) {
                            if (normalized.includes(keyword)) score += 3;
                        }
                        if (score > 0) {
                            results.push({ type: 'feature', data: feature, score });
                        }
                    }
                }

                // Recherche dans les concours
                for (const giveaway of this.kb.giveaways) {
                    let score = 0;
                    for (const keyword of giveaway.keywords) {
                        if (normalized.includes(keyword)) score += 3;
                    }
                    if (score > 0) {
                        results.push({ type: 'giveaway', data: giveaway, score });
                    }
                }

                return results.sort((a, b) => b.score - a.score);
            }

            // G√©n√©ration de r√©ponse
            generateResponse(message) {
                const intent = this.detectIntent(message);
                const searchResults = this.search(message);

                console.log('Intent d√©tect√©:', intent);
                console.log('R√©sultats de recherche:', searchResults);

                // Si des r√©sultats pr√©cis sont trouv√©s
                if (searchResults.length > 0 && searchResults[0].score > 2) {
                    const topResult = searchResults[0];
                    
                    switch (topResult.type) {
                        case 'service':
                            return this.formatServiceResponse(topResult.data, searchResults.slice(0, 3));
                        case 'plan':
                            return this.formatPlanResponse(topResult.data);
                        case 'feature':
                            return this.formatFeatureResponse(topResult.data);
                        case 'giveaway':
                            return this.formatGiveawayResponse(topResult.data);
                    }
                }

                // R√©ponses bas√©es sur l'intention
                switch (intent.intent) {
                    case 'services':
                        return this.getServicesOverview();
                    case 'plans':
                        return this.getPlansOverview();
                    case 'features':
                        return this.getFeaturesOverview();
                    case 'giveaways':
                        return this.getGiveawaysOverview();
                    case 'support':
                        return this.getSupportInfo();
                    case 'staff':
                        return this.getStaffInfo();
                    case 'referral':
                        return this.getReferralInfo();
                    default:
                        return this.getDefaultResponse();
                }
            }

            // Formatage des r√©ponses par type
            formatServiceResponse(service, similarServices) {
                let response = `### ${service.emoji} ${service.name}\n\n`;
                response += `**P√©riode d'essai** : ${service.trial}\n\n`;
                response += `${service.description}\n\n`;
                response += `üìÇ **Cat√©gorie** : ${service.category}`;

                const quickReplies = ['Autres services', 'Comment r√©clamer ?', 'Mon abonnement'];
                
                if (similarServices.length > 1) {
                    quickReplies.unshift(`Voir ${similarServices[1].data.name}`);
                }

                return { text: response, quickReplies };
            }

            formatPlanResponse(plan) {
                let response = `### ${plan.emoji} ${plan.name}\n\n`;
                response += `**Prix** : ${plan.price}\n\n`;
                response += `**Avantages inclus** :\n`;
                for (const feature of plan.features) {
                    response += `‚Ä¢ ${feature}\n`;
                }

                return {
                    text: response,
                    quickReplies: ['Am√©liorer mon plan', 'Comparer les plans', 'Services disponibles']
                };
            }

            formatFeatureResponse(feature) {
                let response = `### ${feature.emoji} ${feature.name}\n\n`;
                response += `${feature.description}\n\n`;
                if (feature.requirements) {
                    response += `‚ö†Ô∏è **Requis** : ${feature.requirements}\n`;
                }
                if (feature.price) {
                    response += `üí∞ **Tarif** : ${feature.price}`;
                }

                return {
                    text: response,
                    quickReplies: ['Autres fonctionnalit√©s', 'Mon abonnement', 'Comment utiliser ?']
                };
            }

            formatGiveawayResponse(giveaway) {
                let response = `### ${giveaway.emoji} ${giveaway.name}\n\n`;
                response += `**Statut** : ${giveaway.status} üî¥\n\n`;
                response += `${giveaway.description}\n\n`;
                response += `**Prix √† gagner** :\n`;
                for (const prize of giveaway.prizes) {
                    response += `‚Ä¢ ${prize}\n`;
                }
                response += `\nüë• ${giveaway.participants} participants\n`;
                response += `üéÅ ${giveaway.winners} gagnants\n`;
                response += `‚è∞ Se termine dans ${giveaway.endsIn}`;

                return {
                    text: response,
                    quickReplies: ['Comment participer ?', 'Autres concours', 'Mes chances de gagner']
                };
            }

            // Vues d'ensemble
            getServicesOverview() {
                let response = `üéØ **Services BloumeGen**\n\n`;
                response += `Nous proposons **18 services** dans 7 cat√©gories :\n\n`;
                response += `üì∫ **Streaming** : Crunchyroll, ADN, Plex, Molotov, Paramount+, Fox, Curiosity Stream\n`;
                response += `üéÆ **Gaming** : Steam\n`;
                response += `üéµ **Musique** : Spotify, Deezer\n`;
                response += `üîê **VPN** : SurfShark, ProtonVPN, Norton\n`;
                response += `üçî **Food** : Quick BR, Quick FR, O'tacos\n`;
                response += `üíª **Logiciels** : Driver Booster 13 Pro\n`;
                response += `üßò **Bien-√™tre** : HeadSpace\n\n`;
                response += `Tous les comptes sont **100% priv√©s et s√©curis√©s** !`;

                return {
                    text: response,
                    quickReplies: ['Voir Crunchyroll', 'Voir Steam', 'Voir Spotify', 'Comment r√©clamer ?']
                };
            }

            getPlansOverview() {
                let response = `üíé **Plans d'abonnement BloumeGen**\n\n`;
                response += `### ‚≠ê Plan Solo\n`;
                response += `**√Ä partir de 4.99‚Ç¨**\n`;
                response += `‚Ä¢ Acc√®s aux services de base\n`;
                response += `‚Ä¢ Support par ticket\n`;
                response += `‚Ä¢ Historique et classements\n\n`;
                response += `### üíé Plan Duo (Recommand√©)\n`;
                response += `**√Ä partir de 9.99‚Ç¨**\n`;
                response += `‚Ä¢ Tout du Plan Solo\n`;
                response += `‚Ä¢ Auto-g√©n√©ration VIP\n`;
                response += `‚Ä¢ Webhooks en temps r√©el\n`;
                response += `‚Ä¢ BloumeHosting inclus\n`;
                response += `‚Ä¢ Support prioritaire\n`;
                response += `‚Ä¢ 168h de pubs offertes`;

                return {
                    text: response,
                    quickReplies: ['Am√©liorer mon plan', 'Diff√©rences Solo/Duo', 'Moyens de paiement']
                };
            }

            getFeaturesOverview() {
                let response = `‚ö° **Fonctionnalit√©s BloumeGen**\n\n`;
                response += `üîî **Webhooks VIP** : Notifications temps r√©el sur Discord/Telegram\n\n`;
                response += `ü§ñ **Auto-G√©n√©ration** : Recevez vos comptes automatiquement\n\n`;
                response += `üöÄ **BloumeHosting** : H√©bergement haute performance\n\n`;
                response += `üì¢ **Publicit√©s ADS** : Boostez votre visibilit√©\n\n`;
                response += `üìã **Historique** : Consultez tous vos comptes\n\n`;
                response += `üèÜ **Classements** : Suivez votre progression\n\n`;
                response += `üéñÔ∏è **Succ√®s** : D√©bloquez des badges exclusifs`;

                return {
                    text: response,
                    quickReplies: ['Webhooks VIP', 'Auto-g√©n√©ration', 'BloumeHosting']
                };
            }

            getGiveawaysOverview() {
                let response = `üéÅ **Concours en cours**\n\n`;
                for (const giveaway of this.kb.giveaways) {
                    response += `### ${giveaway.emoji} ${giveaway.name}\n`;
                    response += `‚Ä¢ ${giveaway.participants} participants / ${giveaway.winners} gagnants\n`;
                    response += `‚Ä¢ Se termine dans ${giveaway.endsIn}\n\n`;
                }
                response += `Participez gratuitement depuis votre tableau de bord !`;

                return {
                    text: response,
                    quickReplies: ['Concours No√´l', 'Concours Nouvel An', 'Comment participer ?']
                };
            }

            getSupportInfo() {
                let response = `üé´ **Centre de Support BloumeGen**\n\n`;
                response += `Besoin d'aide ? Nous sommes l√† pour vous !\n\n`;
                response += `**Ouvrir un ticket** : R√©ponse en < 24h\n`;
                response += `**Tutoriels** : Guides d√©taill√©s pour tout comprendre\n`;
                response += `**FAQ** : R√©ponses aux questions fr√©quentes\n\n`;
                response += `üí¨ Notre √©quipe est disponible 7j/7 !`;

                return {
                    text: response,
                    quickReplies: ['Ouvrir un ticket', 'Voir les tutoriels', 'FAQ compl√®te']
                };
            }

            getStaffInfo() {
                let response = `üë• **Rejoignez l'√©quipe BloumeGen**\n\n`;
                response += `üõ°Ô∏è **Rejoindre le Staff**\n`;
                response += `Devenez mod√©rateur et aidez la communaut√©\n\n`;
                response += `üì¶ **Devenir Fournisseur**\n`;
                response += `Partagez vos services et gagnez de l'argent\n\n`;
                response += `Postulez depuis votre tableau de bord !`;

                return {
                    text: response,
                    quickReplies: ['Conditions Staff', 'Avantages Fournisseur', 'Postuler']
                };
            }

            getReferralInfo() {
                let response = `üéØ **Programme de Parrainage**\n\n`;
                response += `Invitez vos amis et gagnez :\n\n`;
                response += `üí∞ **5 cr√©dits** par inscription\n`;
                response += `‚è∞ **7 jours d'abonnement** tous les 5 parrainages\n`;
                response += `üéñÔ∏è **Badges exclusifs** de parrain\n`;
                response += `üöÄ **Publicit√©s gratuites** pour les meilleurs\n\n`;
                response += `Votre lien de parrainage est disponible dans votre dashboard !`;

                return {
                    text: response,
                    quickReplies: ['Mon lien de parrainage', 'Mes r√©compenses', 'Classement parrains']
                };
            }

            getDefaultResponse() {
                const responses = [
                    {
                        text: `Je n'ai pas bien compris votre question. ü§î\n\nVoici ce que je peux vous aider √† trouver :`,
                        quickReplies: ['Services disponibles', 'Plans VIP', 'Concours en cours', 'Support']
                    },
                    {
                        text: `Hmm, je ne suis pas s√ªr de comprendre. üòÖ\n\nPeut-√™tre puis-je vous aider avec :`,
                        quickReplies: ['Voir tous les services', 'Mon abonnement', 'Ouvrir un ticket']
                    }
                ];

                return responses[Math.floor(Math.random() * responses.length)];
            }
        }

        // ====================================
        // GESTION DE L'INTERFACE
        // ====================================
        const chatAI = new ChatAI(KNOWLEDGE_BASE);
        
        // √âl√©ments DOM
        const elements = {
            button: document.getElementById('bloume-chatbot-button'),
            container: document.getElementById('bloume-chatbot-container'),
            closeBtn: document.getElementById('bloume-close-btn'),
            messages: document.getElementById('bloume-messages'),
            input: document.getElementById('bloume-input'),
            sendBtn: document.getElementById('bloume-send-btn'),
            historyBtn: document.getElementById('bloume-history-btn'),
            settingsBtn: document.getElementById('bloume-settings-btn'),
            sidebar: document.getElementById('bloume-sidebar'),
            sidebarClose: document.getElementById('bloume-sidebar-close'),
            sidebarTitle: document.getElementById('bloume-sidebar-title'),
            sidebarContent: document.getElementById('bloume-sidebar-content'),
            suggestions: document.getElementById('bloume-suggestions'),
            notificationBadge: document.getElementById('bloume-notification-badge')
        };

        // Event Listeners
        elements.button.addEventListener('click', toggleChat);
        elements.closeBtn.addEventListener('click', toggleChat);
        elements.sendBtn.addEventListener('click', sendMessage);
        elements.input.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });
        elements.input.addEventListener('input', handleInputChange);
        elements.historyBtn.addEventListener('click', () => openSidebar('history'));
        elements.settingsBtn.addEventListener('click', () => openSidebar('settings'));
        elements.sidebarClose.addEventListener('click', closeSidebar);

        // Toggle Chat
        function toggleChat() {
            BloumeChat.isOpen = !BloumeChat.isOpen;
            elements.container.classList.toggle('active');
            
            if (BloumeChat.isOpen) {
                elements.input.focus();
                elements.notificationBadge.classList.remove('show');
                loadWelcomeMessage();
            }
        }

        // Chargement du message de bienvenue
        function loadWelcomeMessage() {
            if (BloumeChat.currentConversation.length === 0) {
                setTimeout(() => {
                    const welcomeQuickReplies = [
                        'Services disponibles',
                        'Mon abonnement',
                        'Concours en cours',
                        'Comment √ßa marche ?'
                    ];
                    addMessage(
                        "üëã Salut ! Je suis l'assistant intelligent de BloumeGen.\n\nComment puis-je vous aider aujourd'hui ?",
                        'bot',
                        welcomeQuickReplies
                    );
                }, 500);
            }
        }

        // Envoi de message
        function sendMessage() {
            const message = elements.input.value.trim();
            if (!message) return;

            // Ajouter le message utilisateur
            addMessage(message, 'user');
            elements.input.value = '';
            elements.suggestions.classList.remove('show');

            // D√©sactiver le bouton pendant le traitement
            elements.sendBtn.disabled = true;

            // Afficher l'indicateur de frappe
            showTypingIndicator();

            // Simuler un d√©lai de traitement
            setTimeout(() => {
                const response = chatAI.generateResponse(message);
                removeTypingIndicator();
                addMessage(response.text, 'bot', response.quickReplies);
                elements.sendBtn.disabled = false;

                // Sauvegarder dans l'historique
                BloumeChat.stats.totalMessages += 2;
                saveToLocalStorage();
            }, 800 + Math.random() * 700);
        }

        // Ajout d'un message
        function addMessage(text, sender, quickReplies = []) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `bloume-message ${sender}`;

            const time = new Date().toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });

            let html = `
                <div class="bloume-message-wrapper">
                    <div class="bloume-message-avatar">${sender === 'bot' ? 'ü§ñ' : 'üë§'}</div>
                    <div>
                        <div class="bloume-message-content">${formatMessage(text)}</div>
                        <div class="bloume-message-time">${time}</div>
            `;

            if (sender === 'bot') {
                html += `
                    <div class="bloume-message-actions">
                        <button class="bloume-action-btn" onclick="copyMessage(this)" title="Copier">üìã</button>
                        <button class="bloume-action-btn" onclick="likeMessage(this)" title="Utile">üëç</button>
                        <button class="bloume-action-btn" onclick="dislikeMessage(this)" title="Pas utile">üëé</button>
                    </div>
                `;
            }

            html += '</div></div>';

            if (quickReplies.length > 0) {
                html += '<div class="bloume-quick-replies">';
                for (const reply of quickReplies) {
                    html += `<button class="bloume-quick-reply" onclick="sendQuickReply('${escapeHtml(reply)}')">${escapeHtml(reply)}</button>`;
                }
                html += '</div>';
            }

            messageDiv.innerHTML = html;

            // Supprimer le message de bienvenue si c'est le premier message
            const welcomeMsg = elements.messages.querySelector('.bloume-welcome-message');
            if (welcomeMsg && BloumeChat.currentConversation.length === 0) {
                welcomeMsg.remove();
            }

            elements.messages.appendChild(messageDiv);
            elements.messages.scrollTop = elements.messages.scrollHeight;

            // Sauvegarder dans la conversation
            BloumeChat.currentConversation.push({
                text,
                sender,
                time: new Date().toISOString()
            });
        }

        // Formatage du message (support Markdown basique)
        function formatMessage(text) {
            return text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\n/g, '<br>')
                .replace(/^### (.*$)/gm, '<h4>$1</h4>')
                .replace(/^‚Ä¢ /gm, '&bull; ');
        }

        // Indicateur de frappe
        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'bloume-message bot';
            typingDiv.id = 'bloume-typing-indicator';
            typingDiv.innerHTML = `
                <div class="blo
ume-message-wrapper">
                    <div class="bloume-message-avatar">ü§ñ</div>
                    <div class="bloume-typing-indicator">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
            `;
            elements.messages.appendChild(typingDiv);
            elements.messages.scrollTop = elements.messages.scrollHeight;
        }

        function removeTypingIndicator() {
            const typingIndicator = document.getElementById('bloume-typing-indicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        // R√©ponse rapide
        window.sendQuickReply = function(text) {
            elements.input.value = text;
            sendMessage();
        };

        // Actions sur les messages
        window.copyMessage = function(btn) {
            const messageContent = btn.closest('.bloume-message-wrapper').querySelector('.bloume-message-content').innerText;
            navigator.clipboard.writeText(messageContent);
            btn.innerHTML = '‚úì';
            setTimeout(() => {
                btn.innerHTML = 'üìã';
            }, 2000);
        };

        window.likeMessage = function(btn) {
            btn.style.color = 'var(--success)';
            BloumeChat.stats.satisfaction++;
            saveToLocalStorage();
        };

        window.dislikeMessage = function(btn) {
            btn.style.color = 'var(--error)';
        };

        // Gestion des suggestions
        function handleInputChange() {
            const value = elements.input.value.trim();
            
            if (value.length < 2) {
                elements.suggestions.classList.remove('show');
                return;
            }

            const suggestions = generateSuggestions(value);
            if (suggestions.length > 0) {
                displaySuggestions(suggestions);
            } else {
                elements.suggestions.classList.remove('show');
            }
        }

        function generateSuggestions(query) {
            const normalized = query.toLowerCase();
            const suggestions = [];

            // Suggestions de commandes rapides
            const commands = [
                { text: '/services - Voir tous les services', icon: 'üéØ' },
                { text: '/plans - Comparer les abonnements', icon: 'üíé' },
                { text: '/concours - Concours en cours', icon: 'üéÅ' },
                { text: '/support - Ouvrir un ticket', icon: 'üé´' },
                { text: '/help - Aide compl√®te', icon: '‚ùì' }
            ];

            for (const cmd of commands) {
                if (cmd.text.toLowerCase().includes(normalized)) {
                    suggestions.push(cmd);
                }
            }

            // Suggestions de services
            const commonServices = ['Crunchyroll', 'Steam', 'Spotify', 'Netflix', 'Discord', 'Deezer'];
            for (const service of commonServices) {
                if (service.toLowerCase().includes(normalized)) {
                    suggestions.push({ text: `Voir le service ${service}`, icon: 'üì∫' });
                }
            }

            return suggestions.slice(0, 5);
        }

        function displaySuggestions(suggestions) {
            elements.suggestions.innerHTML = '';
            for (const suggestion of suggestions) {
                const item = document.createElement('div');
                item.className = 'bloume-suggestion-item';
                item.innerHTML = `<span class="bloume-suggestion-icon">${suggestion.icon}</span>${suggestion.text}`;
                item.onclick = () => {
                    elements.input.value = suggestion.text.split(' - ')[0];
                    elements.suggestions.classList.remove('show');
                    elements.input.focus();
                };
                elements.suggestions.appendChild(item);
            }
            elements.suggestions.classList.add('show');
        }

        // Gestion du menu lat√©ral
        function openSidebar(type) {
            elements.sidebar.classList.add('active');
            
            switch (type) {
                case 'history':
                    elements.sidebarTitle.textContent = 'Historique';
                    loadHistorySidebar();
                    break;
                case 'settings':
                    elements.sidebarTitle.textContent = 'Param√®tres';
                    loadSettingsSidebar();
                    break;
            }
        }

        function closeSidebar() {
            elements.sidebar.classList.remove('active');
        }

        function loadHistorySidebar() {
            let html = '<div class="bloume-sidebar-section">';
            html += '<h4>Conversations r√©centes</h4>';
            
            if (BloumeChat.conversations.length === 0) {
                html += '<p style="color: var(--text-secondary); font-size: 14px;">Aucune conversation sauvegard√©e</p>';
            } else {
                for (let i = BloumeChat.conversations.length - 1; i >= Math.max(0, BloumeChat.conversations.length - 10); i--) {
                    const conv = BloumeChat.conversations[i];
                    html += `
                        <div class="bloume-history-item" onclick="loadConversation(${i})">
                            <div class="bloume-history-title">Conversation ${i + 1}</div>
                            <div class="bloume-history-time">${new Date(conv.date).toLocaleDateString('fr-FR')}</div>
                        </div>
                    `;
                }
            }
            
            html += '</div>';
            html += '<div class="bloume-sidebar-section">';
            html += '<h4>Statistiques</h4>';
            html += '<div class="bloume-stats-grid">';
            html += `
                <div class="bloume-stat-card">
                    <div class="bloume-stat-value">${BloumeChat.stats.totalMessages}</div>
                    <div class="bloume-stat-label">Messages</div>
                </div>
                <div class="bloume-stat-card">
                    <div class="bloume-stat-value">${BloumeChat.conversations.length}</div>
                    <div class="bloume-stat-label">Conversations</div>
                </div>
                <div class="bloume-stat-card">
                    <div class="bloume-stat-value">${Math.round(BloumeChat.stats.satisfaction * 100 / Math.max(1, BloumeChat.stats.totalMessages))}%</div>
                    <div class="bloume-stat-label">Satisfaction</div>
                </div>
                <div class="bloume-stat-card">
                    <div class="bloume-stat-value">< 1s</div>
                    <div class="bloume-stat-label">R√©ponse</div>
                </div>
            `;
            html += '</div></div>';
            
            elements.sidebarContent.innerHTML = html;
        }

        function loadSettingsSidebar() {
            let html = '<div class="bloume-sidebar-section">';
            html += '<h4>Pr√©f√©rences</h4>';
            
            const settings = [
                { key: 'darkMode', label: 'Mode sombre', description: 'Interface en th√®me sombre' },
                { key: 'notifications', label: 'Notifications', description: 'Recevoir des notifications' },
                { key: 'soundEffects', label: 'Sons', description: 'Effets sonores des messages' },
                { key: 'autoSuggestions', label: 'Suggestions auto', description: 'Suggestions pendant la saisie' },
                { key: 'saveHistory', label: 'Historique', description: 'Sauvegarder les conversations' }
            ];

            for (const setting of settings) {
                const isActive = BloumeChat.settings[setting.key];
                html += `
                    <div class="bloume-setting-item">
                        <div class="bloume-setting-info">
                            <h5>${setting.label}</h5>
                            <p>${setting.description}</p>
                        </div>
                        <div class="bloume-toggle ${isActive ? 'active' : ''}" onclick="toggleSetting('${setting.key}')"></div>
                    </div>
                `;
            }
            
            html += '</div>';
            html += '<div class="bloume-sidebar-section">';
            html += '<h4>Actions</h4>';
            html += `
                <button class="bloume-action-btn" onclick="exportConversations()" style="width: 100%; padding: 12px; margin-bottom: 8px; background: var(--card-bg); color: var(--text-primary); border-radius: 8px;">
                    üì• Exporter les conversations
                </button>
                <button class="bloume-action-btn" onclick="clearHistory()" style="width: 100%; padding: 12px; background: var(--error); color: white; border-radius: 8px;">
                    üóëÔ∏è Effacer l'historique
                </button>
            `;
            html += '</div>';
            
            elements.sidebarContent.innerHTML = html;
        }

        window.toggleSetting = function(key) {
            BloumeChat.settings[key] = !BloumeChat.settings[key];
            saveToLocalStorage();
            loadSettingsSidebar();
        };

        window.loadConversation = function(index) {
            const conv = BloumeChat.conversations[index];
            elements.messages.innerHTML = '';
            
            for (const msg of conv.messages) {
                addMessage(msg.text, msg.sender, []);
            }
            
            closeSidebar();
        };

        window.exportConversations = function() {
            const data = JSON.stringify(BloumeChat.conversations, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bloumegen-conversations-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
        };

        window.clearHistory = function() {
            if (confirm('√ätes-vous s√ªr de vouloir effacer tout l\'historique ?')) {
                BloumeChat.conversations = [];
                BloumeChat.currentConversation = [];
                BloumeChat.stats = {
                    totalMessages: 0,
                    totalConversations: 0,
                    averageResponseTime: 0,
                    satisfaction: 0
                };
                saveToLocalStorage();
                elements.messages.innerHTML = '<div class="bloume-welcome-message"><div class="bloume-welcome-icon">üëã</div><h2>Bienvenue sur BloumeGen !</h2><p>Je suis votre assistant intelligent. Posez-moi toutes vos questions !</p></div>';
                loadHistorySidebar();
            }
        };

        // LocalStorage
        function saveToLocalStorage() {
            if (BloumeChat.settings.saveHistory) {
                localStorage.setItem('bloume-chat-data', JSON.stringify(BloumeChat));
            }
        }

        function loadFromLocalStorage() {
            const data = localStorage.getItem('bloume-chat-data');
            if (data) {
                const saved = JSON.parse(data);
                BloumeChat.conversations = saved.conversations || [];
                BloumeChat.settings = { ...BloumeChat.settings, ...saved.settings };
                BloumeChat.stats = { ...BloumeChat.stats, ...saved.stats };
            }
        }

        // Utilitaires
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Commandes rapides
        elements.input.addEventListener('keydown', (e) => {
            if (e.key === '/' && elements.input.value === '') {
                e.preventDefault();
                displayCommandsMenu();
            }
        });

        function displayCommandsMenu() {
            const commands = [
                { cmd: '/services', desc: 'Voir tous les services disponibles' },
                { cmd: '/plans', desc: 'Comparer les plans d\'abonnement' },
                { cmd: '/concours', desc: 'Concours en cours' },
                { cmd: '/support', desc: 'Ouvrir un ticket de support' },
                { cmd: '/webhooks', desc: 'Configurer les webhooks VIP' },
                { cmd: '/hosting', desc: 'BloumeHosting' },
                { cmd: '/parrainage', desc: 'Programme de parrainage' },
                { cmd: '/help', desc: 'Aide compl√®te' }
            ];

            const suggestions = commands.map(c => ({
                text: `${c.cmd} - ${c.desc}`,
                icon: '‚ö°'
            }));

            displaySuggestions(suggestions);
        }

        // Initialisation
        function init() {
            loadFromLocalStorage();
            console.log('ü§ñ BloumeGen Chatbot initialized');
            console.log('üìä Stats:', BloumeChat.stats);
            
            // Afficher le badge de notification
            if (BloumeChat.conversations.length > 0) {
                elements.notificationBadge.textContent = Math.min(BloumeChat.conversations.length, 9);
                elements.notificationBadge.classList.add('show');
            }
        }

        // D√©marrage
        init();

        // Sauvegarder avant fermeture
        window.addEventListener('beforeunload', () => {
            if (BloumeChat.currentConversation.length > 0) {
                BloumeChat.conversations.push({
                    date: new Date().toISOString(),
                    messages: BloumeChat.currentConversation
                });
                BloumeChat.stats.totalConversations++;
            }
            saveToLocalStorage();
        });
    </script>
</body>
</html>
